(function(t){function e(e){for(var i,o,r=e[0],l=e[1],c=e[2],p=0,d=[];p<r.length;p++)o=r[p],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&d.push(n[o][0]),n[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);u&&u(e);while(d.length)d.shift()();return a.push.apply(a,c||[]),s()}function s(){for(var t,e=0;e<a.length;e++){for(var s=a[e],i=!0,r=1;r<s.length;r++){var l=s[r];0!==n[l]&&(i=!1)}i&&(a.splice(e--,1),t=o(o.s=s[0]))}return t}var i={},n={app:0},a=[];function o(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=t,o.c=i,o.d=function(t,e,s){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(s,i,function(e){return t[e]}.bind(null,i));return s},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var u=l;a.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"022a":function(t,e,s){},"0742":function(t,e,s){"use strict";var i=s("4f54"),n=s.n(i);n.a},"1bcb":function(t,e,s){"use strict";var i=s("a4e8"),n=s.n(i);n.a},"2f7b":function(t,e,s){},3250:function(t,e,s){},"42b0":function(t,e,s){"use strict";var i=s("692e"),n=s.n(i);n.a},"4f54":function(t,e,s){},"56d7":function(t,e,s){"use strict";s.r(e);s("e260"),s("e6cf"),s("cca6"),s("a79d");var i=s("2b0e"),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("router-view")],1)},a=[],o={name:"App"},r=o,l=s("2877"),c=Object(l["a"])(r,n,a,!1,null,null,null),u=c.exports,p=s("8c4f"),d=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"parent"},[s("div",{staticClass:"welcome welcome-show"},[s("div",[s("div",{staticClass:"font-light logo-container"},[s("span",[t._v("GUESS THE SONG")]),s("Social",{attrs:{isRussia:t.state.isRussia}})],1),s("div",{staticClass:"bg-light playlist-search"},[s("Autocomplete",{attrs:{fetchFunc:t.autocompleteFetchFunc,dataSelector:t.autocompleteDataSelector,choice:"title",inputname:"playlist",placeholder:"Search for a playlist"},on:{selected:t.playlistChanged}})],1),s("div",{staticStyle:{"text-align":"center"}},[t.state.playlistId?s("router-link",{staticClass:"font-light start-btn",attrs:{"data-position":"bottom",to:"/play/"+t.state.playlistId}},[t._v(" START ")]):t._e()],1)])])])},h=[],f=(s("d81d"),s("ac1f"),s("96cf"),s("1da1")),v=(s("d3b7"),s("6062"),s("3ca3"),s("ddb0"),{times:[1,2,4,8,16],playlistId:"",videos:[],currentVideoIdx:-1,currentTimeIdx:0,isStarted:!1,videoLoaded:!1,players:[{name:"Player 1",key:"ControlLeft",answering:!1,index:0,guessedSongs:new Set([])},{name:"Player 2",key:"ControlRight",answering:!1,index:1,guessedSongs:new Set([])}],isPlaying:!1,validAnswer:null,currentAnswer:null,interimAnswer:null,currentLang:"en-US",originalTitle:null,isAnswerInput:!1,isRussia:!1}),g=(s("c975"),s("841c"),s("d4ec")),m=s("bee2"),y=function(){function t(){Object(g["a"])(this,t)}return Object(m["a"])(t,[{key:"setupApi",value:function(t){try{window.gapi.load("client",(function(){window.gapi.client.init({apiKey:"AIzaSyDJ-C1iCx6-VrYyAE1c_y9RQEQ9wa9k5hg",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest","https://kgsearch.googleapis.com/$discovery/rest?version=v1"]}).then(t)}))}catch(e){console.log(e)}}},{key:"getVideosFromPlaylist",value:function(t,e){window.gapi.client.request({path:"https://www.googleapis.com/youtube/v3/playlistItems?part=contentDetails&maxResults=50&playlistId="+t}).then(e)}},{key:"getVideoDetails",value:function(t,e,s){console.log(s),window.gapi.client.youtube.videos.list({part:["contentDetails","snippet","status"],id:[t]}).then((function(i){console.log(i);var n=i.result.items[0],a=n&&n.snippet&&n.snippet.title&&n.status&&n.status.embeddable&&"private"!==n.status.privacyStatus&&"processed"===n.status.uploadStatus&&(!n.contentDetails.regionRestriction||!n.contentDetails.regionRestriction.blocked||-1===n.contentDetails.regionRestriction.blocked.indexOf(s));e(t,n.snippet.title,a,n.contentDetails)}),(function(t){console.error("Execute error",t)}))}},{key:"getPlaylists",value:function(t){return window.gapi.client.youtube.search.list({part:["snippet"],q:t,type:["playlist"]})}},{key:"getPlaylistDetails",value:function(t){return window.gapi.client.youtube.playlists.list({part:["contentDetails","snippet"],id:[t]})}}]),t}(),w=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"autocomplete"},[s("form",{staticClass:"input-field",attrs:{autocomplete:"off"},on:{submit:function(t){t.preventDefault()}}},[s("i",{staticClass:"material-icons prefix font-bg search-button",on:{click:t.onEnter}},[t._v("search")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.searchquery,expression:"searchquery"}],staticClass:"font-bg",attrs:{type:"text",placeholder:t.placeholder,name:t.inputname,id:"autocomplete"},domProps:{value:t.searchquery},on:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnter(e)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?null:t.onArrowUp(e)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?null:t.onArrowDown(e)}],input:function(e){e.target.composing||(t.searchquery=e.target.value)}}}),s("label",{staticClass:"playlist-label",attrs:{for:"autocomplete"}},[t._v("Playlist")]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isOpen,expression:"isOpen"}],staticClass:"autocomplete-result"},[s("ul",{staticClass:"list-group"},t._l(t.results,(function(e,i){return s("li",{key:e.id,staticClass:"list-group-item",class:{"is-active":i===t.arrowCounter},on:{click:function(s){return t.setResult(e)}}},[t._v(" "+t._s(e[t.choice])+" ")])})),0)])])])},b=[],C={name:"Autocomplete",props:{choice:{type:String,required:!0},placeholder:String,inputname:String,fetchFunc:Function,dataSelector:Function},data:function(){return{searchquery:"",results:[],isOpen:!1,arrowCounter:-1}},methods:{autoComplete:function(){var t=this;this.$emit("autocomplete-start"),this.results=[],this.searchquery.length>2&&this.fetchFunc(this.searchquery).then((function(e){t.results=t.dataSelector(e),t.isOpen=!0,console.log(t.results)})).catch((function(t){console.log(t)}))},setResult:function(t){this.isOpen=!1,this.searchquery=t[this.choice],this.$emit("selected",t)},onArrowDown:function(){this.arrowCounter<this.results.length-1&&(this.arrowCounter=this.arrowCounter+1)},onArrowUp:function(){this.arrowCounter>0&&(this.arrowCounter=this.arrowCounter-1)},onEnter:function(){this.isOpen?(this.setResult(this.results[this.arrowCounter]),this.arrowCounter=-1):this.autoComplete()},handleClickOutside:function(t){this.$el.contains(t.target)||(this.isOpen=!1,this.arrowCounter=-1)}},mounted:function(){document.addEventListener("click",this.handleClickOutside)},destroyed:function(){document.removeEventListener("click",this.handleClickOutside)}},_=C,A=(s("1bcb"),Object(l["a"])(_,w,b,!1,null,"1e68241a",null)),S=A.exports,k=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"social"},[t.isRussia?s("a",{attrs:{target:"_blank",href:"https://youtube.com/channel/UCTouVBo2xQSqZNDdo_x0UiQ"}},[s("img",{staticClass:"youtube",attrs:{src:"images/yt_icon_mono_dark.png"}})]):t._e(),t.isRussia?t._e():s("a",{attrs:{target:"_blank",href:"https://youtube.com/user/dmisterb"}},[s("img",{staticClass:"youtube",attrs:{src:"images/yt_icon_mono_dark.png"}})])])},x=[],T={name:"Social",props:{isRussia:Boolean}},I=T,P=(s("0742"),Object(l["a"])(I,k,x,!1,null,"4ba73056",null)),O=P.exports,$=s("bc3a"),R=s.n($),L=function(){function t(){Object(g["a"])(this,t)}return Object(m["a"])(t,[{key:"getRegion",value:function(){var t=Object(f["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,R.a.get("http://www.geoplugin.net/json.gp");case 3:return e=t.sent,console.log(e),t.abrupt("return",e.data.geoplugin_countryCode);case 8:return t.prev=8,t.t0=t["catch"](0),t.abrupt("return","US");case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));function e(){return t.apply(this,arguments)}return e}()}]),t}(),E={name:"Home",components:{Autocomplete:S,Social:O},data:function(){return{state:v,youtube:null,playlists:[]}},methods:{autocompleteFetchFunc:function(t){var e=this.getPlaylistId(t);return e?(console.log(e),this.youtube.getPlaylistDetails(e).then((function(t){return{result:{items:[{id:{playlistId:t.result.items[0].id},snippet:t.result.items[0].snippet}]}}}),(function(t){console.log(t)}))):this.youtube.getPlaylists(t)},autocompleteDataSelector:function(t){return t.result.items.map((function(t){return{title:t.snippet.title,id:t.id.playlistId}}))},playlistChanged:function(t){this.state.playlistId=t.id},getPlaylistId:function(t){var e=/=(PL(\w|-)+?)($|&)/g,s=e.exec(t);if(s)return s[1]}},mounted:function(){var t=Object(f["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(new L).getRegion();case 2:t.t0=t.sent,this.state.isRussia="RU"==t.t0,this.state.playlistId=this.$route.params.id,this.youtube=new y,this.youtube.setupApi((function(){}));case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},j=E,z=(s("a616"),Object(l["a"])(j,d,h,!1,null,"aeb5c0b0",null)),D=z.exports,F=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"parent"},[s("div",{staticClass:"header"},[s("div",{staticClass:"font-light logo-container"},[s("span",[t._v("GUESS THE SONG")]),s("Social",{attrs:{isRussia:t.state.isRussia}})],1),s("div",{staticClass:"font-bg song-counter right-align"},[s("span",{attrs:{id:"songcounter"}},[t._v(" #"+t._s(t.state.currentVideoIdx+1)+" / "+t._s(t.state.videos.length)+" ")])])]),s("div",{staticClass:"playbar"},[s("TransitionAnimation",{ref:"songTransition",attrs:{id:"song"},on:{"transition-animation-close-start":t.songLoaded}},[s("span",{staticClass:"font-light"},[t._v("Song #"+t._s(t.state.currentVideoIdx+1))])]),s("TransitionAnimation",{ref:"videoTransition",attrs:{id:"video",background:"black"},on:{"transition-animation-end":t.finishRound}},[s("div",{style:t.playerStyle},[s("video",{attrs:{id:"player",preload:"auto"}})]),t.isPlayable?t._e():s("div",{staticClass:"font-light",staticStyle:{"font-size":"20px"}},[t._v("Video is not playable and will be skipped")]),s("div",{staticClass:"song-title"},[t._v(t._s(t.state.originalTitle))])]),t.initialized?s("div",{staticClass:"help-container",attrs:{id:"helpbtn"}},[s("a",{staticClass:"font-light btn-help noselect",on:{click:t.showHelp}},[s("i",{staticClass:"material-icons"},[t._v("help_outline")])])]):t._e(),t.initialized?t._e():s("div",{staticClass:"play-container font-light"},[t._v("Loading...")]),t.initialized?s("div",{staticClass:"play-container",attrs:{id:"playbutton"}},[t.state.currentTimeIdx<t.state.times.length?s("span",{staticClass:"font-bg seconds noselect",attrs:{disabled:t.state.isPlaying}},[t._v(t._s(t.currentTime)+"s")]):t._e(),s("a",{staticClass:"tooltipped font-light btn-play noselect",attrs:{"data-position":"bottom","data-tooltip":"Play the song",disabled:t.state.currentTimeIdx>=t.state.times.length||t.state.isPlaying},on:{click:t.handlePlay}},[s("i",{staticClass:"material-icons"},[t._v("play_arrow")])])]):t._e(),t.initialized?s("div",{staticClass:"next-container",attrs:{id:"skipbutton",disabled:t.videoPlaying}},[s("a",{staticClass:"font-light btn-next noselect",on:{click:t.skipSong}},[s("i",{staticClass:"material-icons"},[t._v("skip_next")])])]):t._e(),s("div",{staticClass:"top-progress"},[s("div",{staticClass:"progress"},[!t.initialized||t.state.isPlaying&&!t.videoPlaying?s("div",{staticClass:"indeterminate"}):t._e(),t.initialized||t.videoPlaying?s("div",{staticClass:"determinate",style:t.progressStyle}):t._e()])])],1),s("div",{staticClass:"bg-control font-bg player-left",on:{click:function(e){return t.onAnswerClick(0)}}},[s("span",{staticClass:"player-name noselect"},[t._v(t._s(t.state.players[0].name))]),s("i",{staticClass:"material-icons noselect",attrs:{id:"player1btn"}},[t._v("mic")]),s("span",{staticClass:"points noselect",attrs:{id:"p1points"}},[t._v(t._s(t.state.players[0].guessedSongs.size))])]),s("div",{staticClass:"right-align bg-control font-bg player-right",on:{click:function(e){return t.onAnswerClick(1)}}},[s("span",{staticClass:"points noselect",attrs:{id:"p2points"}},[t._v(t._s(t.state.players[1].guessedSongs.size))]),s("i",{staticClass:"material-icons noselect",attrs:{id:"player2btn"}},[t._v("mic")]),s("span",{staticClass:"player-name noselect"},[t._v(t._s(t.state.players[1].name))])])]),s("AnswerModal",{ref:"answerModal",attrs:{onCancelAnswer:t.onCancelAnswer,playerName:t.currentPlayer.name,playerIndex:t.currentPlayer.index,state:t.state,onCorrectAnswer:t.onCorrectAnswer}}),t._l(t.tooltips,(function(t){return s("Tooltip",{key:t.parentId,ref:"tooltip"+t.parentId,refInFor:!0,attrs:{parentId:t.parentId,text:t.text,width:t.width,position:t.position}})}))],2)},V=[],U=(s("4de4"),s("4160"),s("a15b"),s("a434"),s("b64b"),s("5319"),s("1276"),s("2ca0"),s("498a"),s("159b"),s("4fb8")),N=s.n(U),M=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"transition",staticClass:"song-transition"},[s("div",{ref:"arrow",staticClass:"final-layer"},[s("div",{staticClass:"top"}),s("div",{staticClass:"bottom"})]),s("div",{ref:"content",staticClass:"content-layer"},[s("div",{ref:"sublayer",staticClass:"content-sublayer in",style:t.backgroundStyle},[t._t("default")],2)])])},q=[],G={name:"TransitionAnimation",props:{id:String,background:String},computed:{backgroundStyle:function(){return{backgroundColor:"".concat(this.background)}}},data:function(){return{isOpen:!1}},methods:{play:function(t){var e=this;this.open(),setTimeout((function(){e.close()}),t)},open:function(){var t=this;console.log("opening ".concat(this.id)),this.isOpen=!0,setTimeout((function(){t.$refs.transition.classList.add("show")}),100),setTimeout((function(){t.$refs.arrow.classList.add("movein")}),500),setTimeout((function(){t.$refs.content.classList.add("show"),t.$refs.arrow.classList.add("moveout")}),1200),setTimeout((function(){t.$refs.arrow.classList.remove("movein"),t.$refs.arrow.classList.remove("moveout"),t.$emit("transition-animation-open-end",t.id)}),2200)},close:function(){var t=this;this.isOpen&&(this.$emit("transition-animation-close-start",this.id),this.isOpen=!1,setTimeout((function(){t.$refs.arrow.classList.add("movein")}),500),setTimeout((function(){t.$refs.content.classList.remove("show"),t.$refs.arrow.classList.add("moveout")}),1200),setTimeout((function(){t.$refs.transition.classList.remove("show"),t.$refs.arrow.classList.remove("movein"),t.$refs.arrow.classList.remove("moveout"),t.$refs.content.classList.remove("show"),t.$emit("transition-animation-end",t.id)}),2200))}}},H=G,Q=(s("42b0"),Object(l["a"])(H,M,q,!1,null,"5d5fb190",null)),B=Q.exports,W=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{ref:"tooltip",staticClass:"tooltiptext",class:t.position,style:t.tooltipStyle},[t._v(t._s(t.text))])},J=[],K={name:"Tooltip",props:{text:String,position:String,parentId:String,width:String},data:function(){return{top:0,left:0}},computed:{tooltipStyle:function(){return{top:"".concat(this.top,"px"),left:"".concat(this.left,"px"),width:this.width}}},methods:{toggle:function(){this.positionTooltip(),this.$refs.tooltip.classList.toggle("show")},positionTooltip:function(){var t=document.getElementById(this.parentId);if(t)switch(this.position){case"top":this.top=t.offsetTop-60,this.left=t.offsetLeft+t.offsetWidth/2-parseInt(this.width)/2;break;case"left":this.top=t.offsetTop,this.left=t.offsetLeft-parseInt(this.width)-60;break}}},created:function(){window.addEventListener("resize",this.positionTooltip)},destroyed:function(){window.removeEventListener("resize",this.positionTooltip)}},Y=K,Z=(s("a4fe"),Object(l["a"])(Y,W,J,!1,null,null,null)),X=Z.exports,tt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"modal",staticClass:"answer-modal"},[s("div",{staticClass:"bg-body answer-body"},[s("div",{staticClass:"top-bar"},[t.isSpeechSupported?t._e():s("div",{staticClass:"not-supported-hint"},[t._v("Speech recognition is not supported in this browser. Try a "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API#Browser_compatibility",target:"_blank"}},[t._v("supported")]),t._v(" browser. You can still use your keyboard to type the answer.")]),s("div",{staticClass:"input-switch noselect"},[s("a",{class:{"switch-active":!t.state.isAnswerInput,"switch-inactive":t.state.isAnswerInput,"not-supported":!t.isSpeechSupported},on:{click:t.switchInput}},[s("i",{staticClass:"material-icons"},[t._v("mic")])]),s("a",{staticClass:"switch-right",class:{"switch-active":t.state.isAnswerInput,"switch-inactive":!t.state.isAnswerInput},on:{click:t.switchInput}},[s("i",{staticClass:"material-icons"},[t._v("keyboard")])])])]),t.state.isAnswerInput?t._e():s("div",{staticClass:"input-indicator mic"},[s("i",{staticClass:"material-icons noselect"},[t._v("mic")])]),t.state.isAnswerInput?s("div",{staticClass:"input-indicator"},[s("i",{staticClass:"material-icons noselect"},[t._v("keyboard")])]):t._e(),s("h2",{staticClass:"font-light answer-player-name noselect"},[t._v(" "+t._s(t.playerName)+" "),s("Counter",{ref:"counter"})],1),s("div",{staticClass:"toolbar"},[s("button",{staticClass:"toolbar-button noselect",on:{click:function(e){return t.restart()}}},[s("i",{staticClass:"material-icons"},[t._v("replay")]),t._v("restart")]),s("button",{staticClass:"toolbar-button noselect",on:{click:function(e){return t.close()}}},[s("i",{staticClass:"material-icons"},[t._v("cancel")]),t._v("cancel")])]),s("div",{staticClass:"answer-bar",staticStyle:{position:"relative"}},[t.state.isAnswerInput?t._e():s("span",{staticClass:"answer-hint mic noselect"},[t._v("Speak into your microphone")]),t.state.isAnswerInput?t._e():s("div",{staticClass:"answer-text",class:{"font-incorrect":!t.isAnswerCorrect,"font-correct":t.isAnswerCorrect}},[s("span",[t._v(t._s(t.state.interimAnswer))])]),t.state.isAnswerInput?s("span",{staticClass:"answer-hint noselect"},[t._v("Type your answer:")]):t._e(),t.state.isAnswerInput?s("input",{directives:[{name:"model",rawName:"v-model",value:t.state.currentAnswer,expression:"state.currentAnswer"}],ref:"inputField",staticClass:"answer-text",class:{"font-incorrect":!t.isAnswerCorrect,"font-correct":t.isAnswerCorrect},attrs:{type:"text"},domProps:{value:t.state.currentAnswer},on:{input:function(e){e.target.composing||t.$set(t.state,"currentAnswer",e.target.value)}}}):t._e(),t.state.currentAnswer&&t.isAnswerCorrect?s("i",{staticClass:"material-icons answer-icon noselect",staticStyle:{color:"#00800040"}},[t._v("done")]):t._e(),t.state.currentAnswer&&!t.isAnswerCorrect?s("i",{staticClass:"material-icons answer-icon noselect",staticStyle:{color:"#e2414140"}},[t._v("close")]):t._e()])])])},et=[],st=(s("a9e3"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"counter",staticClass:"counter"},[t._v("+1")])}),it=[],nt={name:"Counter",methods:{show:function(){var t=this;setTimeout((function(){t.$refs.counter.classList.add("movein")}),100),setTimeout((function(){t.$refs.counter.classList.add("moveout")}),1500),setTimeout((function(){var t=["movein","moveout"];t.forEach((function(t){var e=document.querySelectorAll(".".concat(t));[].forEach.call(e,(function(e){e.classList.remove(t)}))}))}),2500)}}},at=nt,ot=(s("f437"),Object(l["a"])(at,st,it,!1,null,"32a357d2",null)),rt=ot.exports,lt=function(){function t(e){Object(g["a"])(this,t),this.recognizing=!1,this.recognition=null,this.outputCallback=e,this.lock=!1,this.endcallback=null,this.startCallback=null,this.stopCallback=null,this.isRestart=!1,this.cancel=null,this.cancelRecognition=!1,this.stopSound=!1}return Object(m["a"])(t,[{key:"setup",value:function(t,e,s){var i=this;this.cancel=s,this.stopCallback=e,this.startCallback=t;var n=window.SpeechRecognition||window.webkitSpeechRecognition;n&&(this.recognition=new n,this.recognition.continuous=!0,this.recognition.interimResults=!0,this.recognition.lang="en-US",this.reset(),this.recognition.onresult=function(t){var e=t.results[t.resultIndex];i.outputCallback(e.isFinal?e[0].transcript:null,e.isFinal?null:e[0].transcript)},this.recognition.onaudiostart=function(){i.recognizing=!0,console.log("Audio capturing started"),i.startCallback&&i.startCallback()},this.recognition.onsoundend=function(){console.log("Sound has stopped being received"),i.cancelRecognition&&(console.log("Closing"),i.recognizing=!1,i.cancel())},this.recognition.onaudioend=function(){i.recognizing=!1,i.stopCallback(),console.log("Audio capturing ended")},this.recognition.onend=function(){i.stopSound?(console.log("OnEnd"),i.reset(),i.stopCallback(),i.endcallback&&(console.log("endcallback"),i.endcallback())):(console.log("Restarting"),setTimeout((function(){i.recognition.start()}),500))})}},{key:"reset",value:function(){this.recognizing=!1}},{key:"start",value:function(t){this.stopSound=!1,this.cancelRecognition=!1,!this.isSupported()||this.recognizing&&!this.isRestart||(console.log("starting speech"),t&&(this.recognition.lang=t),this.recognition.start(),this.recognizing=!0)}},{key:"stop",value:function(t){this.recognizing&&(console.log("stopping speech"),this.cancelRecognition=t,this.stopSound=!0,this.recognition.stop())}},{key:"restart",value:function(){var t=this;if(this.isSupported()){this.isRestart=!0;var e=this.recognition.lang;this.endcallback=function(){t.start(e),t.endcallback=null,t.isRestart=!1},this.stop(!1)}}},{key:"isSupported",value:function(){return!!this.recognition}}]),t}(),ct=s("9a8a"),ut=s.n(ct),pt=function(){function t(e,s,i){Object(g["a"])(this,t),this.state=e,this.successCallback=s,this.timer=null,this.correctnessCallback=i}return Object(m["a"])(t,[{key:"start",value:function(){this.timer=window.setInterval(this.validateAnswer.bind(this),500)}},{key:"validateAnswer",value:function(){if(this.state.validAnswer&&this.state.currentAnswer){var t=this.state.currentAnswer.toLowerCase().split(" ").map((function(t){return t.trim()})).sort().join(" ").trim(),e=ut()([this.state.validAnswerSorted]),s=e.get(t,[[0]]);console.log("Correctness: ",s[0][0]),s[0][0]>.7&&(this.stop(),this.successCallback())}}},{key:"stop",value:function(){window.clearInterval(this.timer)}}]),t}(),dt={name:"AnswerModal",components:{Counter:rt},props:{onCorrectAnswer:Function,onCancelAnswer:Function,playerName:String,playerIndex:Number,state:Object},data:function(){return{speech:null,isSpeechSupported:!1,isOpen:!1,validator:null,isAnswerCorrect:!1}},methods:{onAnswerCorrect:function(){var t=this;this.isAnswerCorrect=!0,this.$refs.counter.show(),console.log("on answer correct"),setTimeout((function(){t.onCorrectAnswer(),console.log("close"),t.close()}),2e3)},switchInput:function(){var t=this;this.isSpeechSupported&&(this.state.isAnswerInput=!this.state.isAnswerInput,this.state.isAnswerInput?(this.speech.stop(!1),setTimeout((function(){t.$refs.inputField.focus()}),300)):this.speech.start(this.state.currentLang))},restart:function(){this.isAnswerCorrect=!1,this.speech.restart(),this.state.currentAnswer=null,this.state.interimAnswer=null},open:function(){var t=this;this.state.currentAnswer=null,this.state.interimAnswer=null,this.isAnswerCorrect=!1,this.$emit("answer-modal-before-open"),this.validator.start(),this.isOpen=!0,this.isSpeechSupported||(this.state.isAnswerInput=!1),this.state.isAnswerInput?setTimeout((function(){t.$refs.inputField.focus()}),300):this.speech.start(this.state.currentLang),this.$refs.modal.classList.add("show")},close:function(){this.isOpen&&(this.$emit("answer-modal-before-close"),this.onCancelAnswer(),this.$refs.modal.classList.remove("show"),this.isOpen=!1,this.validator.stop(),this.speech.stop(!0))},outputAnswer:function(t,e){t&&(this.state.currentAnswer=(this.state.currentAnswer?this.state.currentAnswer+" ":"")+t.replace("-"," ")),this.state.interimAnswer=e?(this.state.currentAnswer?this.state.currentAnswer+" ":"")+e.replace("-"," "):this.state.currentAnswer},onAnswerEnd:function(){this.state.currentAnswer=null}},mounted:function(){this.validator=new pt(this.state,this.onAnswerCorrect),this.speech=new lt(this.outputAnswer),this.speech.setup(this.onAnswerStart,this.onAnswerEnd,this.close),this.isSpeechSupported=this.speech.isSupported()},beforeDestroy:function(){this.speech&&this.speech.stop(),this.validator&&this.validator.stop()}},ht=dt,ft=(s("c0d7"),Object(l["a"])(ht,tt,et,!1,null,"2dd41824",null)),vt=ft.exports,gt={name:"Game",components:{TransitionAnimation:B,AnswerModal:vt,Tooltip:X,Social:O},methods:{detectLang:function(){return/[а-яА-Я]/g.test(this.state.validAnswer)?"ru-RU":"en-US"},songLoaded:function(){this.initialized=!0},showHelp:function(){var t=this,e=Object.keys(this.$refs).filter((function(t){return t.startsWith("tooltip")}));e.forEach((function(e){return t.$refs[e][0].toggle()}))},skipSong:function(){this.state.isPlaying||this.finishCorrectAnswer()},onCancelAnswer:function(){this.answerInited=!1,this.currentPlayer.answering=!1},handleVideoDetails:function(t,e,s,i){if(this.isPlayable=s&&i.duration.indexOf("M")>0,this.state.originalTitle=e,this.player.source={type:"video",sources:[{src:t,provider:"youtube",size:480}]},this.roundFinished=!1,!this.isPlayable)return console.log("not playable"),this.roundFinished=!0,this.initialized=!1,void this.finishCorrectAnswer();this.state.validAnswer=e.replace(/(\(|\[).+?(\)|\])|:|-|\(|\)/gi,"").replace(/official music video/gi,"").replace(/original version/gi,"").replace("HQ","").replace("  "," ").trim(),this.state.validAnswerSorted=this.state.validAnswer.toLowerCase().split(" ").map((function(t){return t.trim()})).sort().join(" "),console.log(this.state.validAnswer),this.state.currentLang=this.detectLang(),this.state.videoLoaded=!0},loadNextVideo:function(){if(this.state.videos.length<=this.state.currentVideoIdx+1)return this.gameOver=!0,this.player.stop(),void this.$router.push("/finish");this.videoProgress=0,this.$refs.songTransition.play(2e3),this.currentPlayer&&(this.currentPlayer.answering=!1),this.state.videoLoaded=!1,this.state.currentVideoIdx++,console.log("play next video"),this.youtube.getVideoDetails(this.state.videos[this.state.currentVideoIdx].contentDetails.videoId,this.handleVideoDetails,this.region)},playVideo:function(){var t=this;console.log("play video"),this.state.isPlaying=!0,this.player.play(),this.loadTimeout=setTimeout((function(){t.player.stop(),t.state.isPlaying=!1,t.state.isPlayable=!1,t.loadNextVideo(),console.log("Can't play the video after 15 seconds")}),15e3)},handlePlay:function(){this.state.isPlaying||this.state.currentTimeIdx>=this.state.times.length||(this.videoProgress=0,this.playVideo())},handleKeyDown:function(t){var e=this;if(!this.answerInited)if(this.answerInited=!0,this.initialized){if(!this.currentPlayer.index){for(var s in this.state.players){var i=this.state.players[s];if(t.code===i.key){i.answering=!0,this.state.currentAnswer=null,this.getAnswer();break}}setTimeout((function(){e.answerInited=!1}),5e3)}}else this.answerInited=!1},onAnswerClick:function(t){var e=this;this.answerInited||(this.answerInited=!0,this.initialized?(this.state.players[t].answering=!0,this.state.currentAnswer=null,this.getAnswer(),setTimeout((function(){e.answerInited=!1}),5e3)):this.answerInited=!1)},getAnswer:function(){this.state.currentAnswer=null,this.$refs.answerModal.open()},onCorrectAnswer:function(){this.initialized=!1,this.answerInited=!1,this.currentPlayer.guessedSongs.add(this.state.videos[this.state.currentVideoIdx].contentDetails.videoId),window.setTimeout(this.finishCorrectAnswer.bind(this),2e3)},finishCorrectAnswer:function(){var t=this;this.initialized=!1,this.roundFinished=!0,this.isPlayable&&this.player.play(),this.state.currentTimeIdx=0,setTimeout((function(){t.$refs.videoTransition.open(),t.isPlayable||setTimeout((function(){t.initialized=!1,t.$refs.videoTransition.close()}),3e3)}),100)},finishRound:function(){this.player.stop(),console.log("finish round"),this.state.currentTimeIdx=0,this.currentPlayer.answering=!1,this.loadNextVideo()}},data:function(){return{startTime:60,snippetStartTime:100,region:"US",gameOver:!1,answerInited:!1,initialized:!1,videoPlaying:!1,youtube:null,player:null,state:v,videoProgress:0,validator:null,videoModal:null,roundFinished:!1,isPlayable:!0,loadTimeout:null,tooltips:[{parentId:"player1btn",text:"Start answering (Left Ctrl)",width:"100px",position:"top"},{parentId:"player2btn",text:"Start answering (Right Ctrl)",width:"100px",position:"top"},{parentId:"playbutton",text:"Play the song",width:"100px",position:"top"},{parentId:"skipbutton",text:"Skip current song",width:"120px",position:"top"},{parentId:"p1points",text:"Score for Player 1",width:"80px",position:"top"},{parentId:"p2points",text:"Score for Player 2",width:"80px",position:"top"},{parentId:"songcounter",text:"Current song number / total song count",width:"120px",position:"left"},{parentId:"helpbtn",text:"Toggle help",width:"120px",position:"top"}]}},computed:{playerStyle:function(){return{display:this.isPlayable?"block":"none"}},progressStyle:function(){return{width:"".concat(this.videoProgress>0?100:0,"%"),transition:this.videoProgress>0?"width ".concat(this.state.times[this.state.currentTimeIdx],"s linear"):"none"}},currentPlayer:function(){for(var t in this.state.players){var e=this.state.players[t];if(e.answering)return e}return{}},currentTime:function(){return this.state.times[this.state.currentTimeIdx]},attemptsEnded:function(){return this.state.currentTimeIdx>this.state.times.length-1}},mounted:function(){var t=Object(f["a"])(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(new L).getRegion();case 2:this.region=t.sent,this.state.isRussia="RU"==this.region,this.state.playlistId=this.$route.params.id,window.addEventListener("keydown",this.handleKeyDown),this.player=new N.a("#player",{controls:[]}),this.player.on("playing",(function(){e.roundFinished&&e.player.currentTime<e.snippetStartTime?(e.player.volume=0,e.player.currentTime=e.snippetStartTime):e.player.currentTime<e.startTime&&(e.player.volume=1,e.player.currentTime=e.startTime)})),this.player.on("timeupdate",(function(t){if(e.loadTimeout)try{console.log("clearing timeout"),clearTimeout(e.loadTimeout),e.loadTimeout=null}catch(n){console.log(n)}if(!e.gameOver)if(e.roundFinished)t.detail.plyr.currentTime>e.snippetStartTime+3?(e.initialized=!1,e.player.decreaseVolume(.05),e.$refs.videoTransition.close()):e.player.increaseVolume(.05);else{e.videoPlaying=t.detail.plyr.currentTime>0;var s=(t.detail.plyr.currentTime-e.startTime)/e.state.times[e.state.currentTimeIdx]*100,i=15/e.state.times[e.state.currentTimeIdx];s-e.videoProgress>i&&(e.videoProgress=Math.min(s+i,100)),t.detail.plyr.currentTime-e.startTime>e.state.times[e.state.currentTimeIdx]&&(e.player.stop(),e.state.isPlaying=!1,e.videoPlaying=!1,e.state.currentTimeIdx++)}})),this.youtube=new y,this.youtube.setupApi((function(){e.youtube.getVideosFromPlaylist(e.state.playlistId,(function(t){if(t.result.items.length<10)e.state.videos=t.result.items.splice(0,10);else{e.state.videos=[];for(var s=0;s<10;s++){var i=Math.floor(Math.random()*t.result.items.length);e.state.videos.push(t.result.items.splice(i,1)[0])}}e.loadNextVideo()}))}));case 11:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},mt=gt,yt=(s("8202"),Object(l["a"])(mt,F,V,!1,null,"4848bb0d",null)),wt=yt.exports,bt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"parent font-light"},[s("div",{staticClass:"header"},[s("div",{staticClass:"logo-container"},[s("span",{staticClass:"logo-guess"},[t._v("GUESS THE SONG")]),s("Social",{attrs:{isRussia:t.state.isRussia}})],1),s("div",{staticClass:"font-bg song-counter"},[t._v(" . ")])]),s("div",{staticClass:"game-over"},[t._v("Game Over")]),s("div",{staticClass:"player1-score"},[s("div",[t._v("Player 1")]),s("div",{staticStyle:{"text-align":"center"}},[t._v(t._s(t.state.players[0].guessedSongs.size))])]),s("div",{staticClass:"versus"},[t._v("VS")]),s("div",{staticClass:"player2-score"},[s("div",[t._v("Player 2")]),s("div",{staticStyle:{"text-align":"center"}},[t._v(t._s(t.state.players[1].guessedSongs.size))])]),t._m(0)])])},Ct=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"play-again"},[s("a",{staticClass:"font-bg",attrs:{href:"/"}},[t._v("Play again")])])}],_t={name:"Finish",components:{Social:O},data:function(){return{state:v}},mounted:function(){}},At=_t,St=(s("e411"),Object(l["a"])(At,bt,Ct,!1,null,"7616033c",null)),kt=St.exports;i["a"].use(p["a"]),i["a"].config.productionTip=!1;var xt=new p["a"]({routes:[{path:"/",component:D},{path:"/finish",component:kt},{path:"/:id",component:D},{path:"/play/:id",component:wt}]});new i["a"]({router:xt,render:function(t){return t(u)}}).$mount("#app")},"692e":function(t,e,s){},"6e60":function(t,e,s){},8202:function(t,e,s){"use strict";var i=s("e8e0"),n=s.n(i);n.a},a4e8:function(t,e,s){},a4fe:function(t,e,s){"use strict";var i=s("eeac"),n=s.n(i);n.a},a616:function(t,e,s){"use strict";var i=s("3250"),n=s.n(i);n.a},c0d7:function(t,e,s){"use strict";var i=s("2f7b"),n=s.n(i);n.a},e411:function(t,e,s){"use strict";var i=s("022a"),n=s.n(i);n.a},e8e0:function(t,e,s){},eeac:function(t,e,s){},f437:function(t,e,s){"use strict";var i=s("6e60"),n=s.n(i);n.a}});
//# sourceMappingURL=app.b7f8ded6.js.map